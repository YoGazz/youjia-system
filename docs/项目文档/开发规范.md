# ä½‘çˆæµ‹è¯•å¹³å°å¼€å‘è§„èŒƒ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº†ä½‘çˆæµ‹è¯•å¹³å°çš„å¼€å‘è§„èŒƒï¼Œæ—¨åœ¨ç¡®ä¿ä»£ç è´¨é‡ã€æé«˜å¼€å‘æ•ˆç‡ã€ä¾¿äºå›¢é˜Ÿåä½œã€‚

## ğŸ—ï¸ é¡¹ç›®ç»“æ„è§„èŒƒ

### åŒ…ç»“æ„è§„èŒƒ
```
com.yoga.youjia
â”œâ”€â”€ YoujiaApplication.java              # ä¸»å¯åŠ¨ç±»
â”œâ”€â”€ config/                             # é…ç½®ç±»
â”‚   â”œâ”€â”€ SecurityConfig.java             # å®‰å…¨é…ç½®
â”‚   â”œâ”€â”€ WebConfig.java                  # Webé…ç½®
â”‚   â”œâ”€â”€ DatabaseConfig.java             # æ•°æ®åº“é…ç½®
â”‚   â””â”€â”€ CacheConfig.java                # ç¼“å­˜é…ç½®
â”œâ”€â”€ controller/                         # æ§åˆ¶å™¨å±‚
â”‚   â”œâ”€â”€ AuthController.java             # è®¤è¯æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ UserController.java             # ç”¨æˆ·æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ ProjectController.java          # é¡¹ç›®æ§åˆ¶å™¨
â”‚   â””â”€â”€ ...
â”œâ”€â”€ service/                            # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ AuthService.java                # è®¤è¯æœåŠ¡
â”‚   â”œâ”€â”€ UserService.java                # ç”¨æˆ·æœåŠ¡
â”‚   â”œâ”€â”€ impl/                           # æœåŠ¡å®ç°ç±»
â”‚   â”‚   â”œâ”€â”€ AuthServiceImpl.java
â”‚   â”‚   â””â”€â”€ UserServiceImpl.java
â”‚   â””â”€â”€ ...
â”œâ”€â”€ repository/                         # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ UserRepository.java             # ç”¨æˆ·æ•°æ®è®¿é—®
â”‚   â”œâ”€â”€ ProjectRepository.java          # é¡¹ç›®æ•°æ®è®¿é—®
â”‚   â””â”€â”€ ...
â”œâ”€â”€ entity/                             # å®ä½“ç±»
â”‚   â”œâ”€â”€ User.java                       # ç”¨æˆ·å®ä½“
â”‚   â”œâ”€â”€ Project.java                    # é¡¹ç›®å®ä½“
â”‚   â””â”€â”€ ...
â”œâ”€â”€ dto/                                # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”œâ”€â”€ request/                        # è¯·æ±‚DTO
â”‚   â”‚   â”œâ”€â”€ LoginRequest.java
â”‚   â”‚   â”œâ”€â”€ RegisterRequest.java
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ response/                       # å“åº”DTO
â”‚   â”‚   â”œâ”€â”€ LoginResponse.java
â”‚   â”‚   â”œâ”€â”€ UserResponse.java
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ ...
â”œâ”€â”€ enums/                              # æšä¸¾ç±»
â”‚   â”œâ”€â”€ UserRole.java                   # ç”¨æˆ·è§’è‰²
â”‚   â”œâ”€â”€ UserStatus.java                 # ç”¨æˆ·çŠ¶æ€
â”‚   â””â”€â”€ ...
â”œâ”€â”€ exception/                          # å¼‚å¸¸ç±»
â”‚   â”œâ”€â”€ BusinessException.java          # ä¸šåŠ¡å¼‚å¸¸
â”‚   â”œâ”€â”€ ResourceNotFoundException.java  # èµ„æºæœªæ‰¾åˆ°å¼‚å¸¸
â”‚   â””â”€â”€ ...
â”œâ”€â”€ security/                           # å®‰å…¨ç›¸å…³
â”‚   â”œâ”€â”€ filter/                         # è¿‡æ»¤å™¨
â”‚   â”œâ”€â”€ service/                        # å®‰å…¨æœåŠ¡
â”‚   â””â”€â”€ util/                           # å®‰å…¨å·¥å…·ç±»
â”œâ”€â”€ util/                               # å·¥å…·ç±»
â”‚   â”œâ”€â”€ JwtUtil.java                    # JWTå·¥å…·ç±»
â”‚   â”œâ”€â”€ DateUtil.java                   # æ—¥æœŸå·¥å…·ç±»
â”‚   â””â”€â”€ ...
â”œâ”€â”€ common/                             # é€šç”¨ç±»
â”‚   â”œâ”€â”€ ApiResponse.java                # ç»Ÿä¸€å“åº”æ ¼å¼
â”‚   â”œâ”€â”€ ResultCode.java                 # ç»“æœç 
â”‚   â”œâ”€â”€ Constants.java                  # å¸¸é‡ç±»
â”‚   â””â”€â”€ ...
â””â”€â”€ aspect/                             # åˆ‡é¢ç±»
    â”œâ”€â”€ LoggingAspect.java              # æ—¥å¿—åˆ‡é¢
    â””â”€â”€ ...
```

## ğŸ“ å‘½åè§„èŒƒ

### ç±»å‘½åè§„èŒƒ
- **Controllerç±»**: ä»¥`Controller`ç»“å°¾ï¼Œå¦‚`UserController`
- **Serviceæ¥å£**: ä»¥`Service`ç»“å°¾ï¼Œå¦‚`UserService`
- **Serviceå®ç°**: ä»¥`ServiceImpl`ç»“å°¾ï¼Œå¦‚`UserServiceImpl`
- **Repositoryç±»**: ä»¥`Repository`ç»“å°¾ï¼Œå¦‚`UserRepository`
- **Entityç±»**: ä½¿ç”¨åè¯ï¼Œå¦‚`User`ã€`Project`
- **DTOç±»**: ä»¥ç”¨é€”ç»“å°¾ï¼Œå¦‚`LoginRequest`ã€`UserResponse`
- **Exceptionç±»**: ä»¥`Exception`ç»“å°¾ï¼Œå¦‚`BusinessException`
- **Utilç±»**: ä»¥`Util`ç»“å°¾ï¼Œå¦‚`JwtUtil`

### æ–¹æ³•å‘½åè§„èŒƒ
- **Controlleræ–¹æ³•**: ä½¿ç”¨HTTPåŠ¨è¯é£æ ¼
  ```java
  @GetMapping("/users/{id}")
  public ApiResponse<UserResponse> getUser(@PathVariable Long id)
  
  @PostMapping("/users")
  public ApiResponse<UserResponse> createUser(@RequestBody CreateUserRequest request)
  
  @PutMapping("/users/{id}")
  public ApiResponse<UserResponse> updateUser(@PathVariable Long id, @RequestBody UpdateUserRequest request)
  
  @DeleteMapping("/users/{id}")
  public ApiResponse<Void> deleteUser(@PathVariable Long id)
  ```

- **Serviceæ–¹æ³•**: ä½¿ç”¨ä¸šåŠ¡è¯­ä¹‰
  ```java
  // æŸ¥è¯¢æ–¹æ³•
  User findById(Long id);
  List<User> findByStatus(UserStatus status);
  Page<User> findByCondition(UserQueryCondition condition, Pageable pageable);
  
  // ä¸šåŠ¡æ–¹æ³•
  User createUser(CreateUserRequest request);
  User updateUser(Long id, UpdateUserRequest request);
  void deleteUser(Long id);
  void enableUser(Long id);
  void disableUser(Long id);
  ```

### å˜é‡å‘½åè§„èŒƒ
- ä½¿ç”¨é©¼å³°å‘½åæ³•
- å¸ƒå°”å˜é‡ä½¿ç”¨`is`ã€`has`ã€`can`ç­‰å‰ç¼€
- é›†åˆå˜é‡ä½¿ç”¨å¤æ•°å½¢å¼
- å¸¸é‡ä½¿ç”¨å¤§å†™å­—æ¯å’Œä¸‹åˆ’çº¿

```java
// æ­£ç¡®ç¤ºä¾‹
private String userName;
private boolean isActive;
private List<User> userList;
private static final String DEFAULT_PASSWORD = "123456";

// é”™è¯¯ç¤ºä¾‹
private String user_name;
private boolean active;
private List<User> user;
private static final String defaultPassword = "123456";
```

## ğŸ¯ ç¼–ç è§„èŒƒ

### æ³¨è§£ä½¿ç”¨è§„èŒƒ

#### å®ä½“ç±»æ³¨è§£
```java
@Entity
@Table(name = "users")
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(name = "username", nullable = false, unique = true, length = 50)
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Size(min = 3, max = 50, message = "ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-50ä¸ªå­—ç¬¦ä¹‹é—´")
    private String username;
    
    @Column(name = "email", nullable = false, unique = true, length = 100)
    @NotBlank(message = "é‚®ç®±ä¸èƒ½ä¸ºç©º")
    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    private String email;
    
    @Enumerated(EnumType.STRING)
    @Column(name = "status", nullable = false)
    private UserStatus status;
    
    @CreationTimestamp
    @Column(name = "created_at", nullable = false, updatable = false)
    private LocalDateTime createdAt;
    
    @UpdateTimestamp
    @Column(name = "updated_at", nullable = false)
    private LocalDateTime updatedAt;
}
```

#### Controllerç±»æ³¨è§£
```java
@RestController
@RequestMapping("/api/users")
@Validated
@Slf4j
@Tag(name = "ç”¨æˆ·ç®¡ç†", description = "ç”¨æˆ·ç›¸å…³æ¥å£")
public class UserController {
    
    @GetMapping("/{id}")
    @Operation(summary = "è·å–ç”¨æˆ·ä¿¡æ¯", description = "æ ¹æ®ç”¨æˆ·IDè·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯")
    @ApiResponses({
        @ApiResponse(responseCode = "200", description = "è·å–æˆåŠŸ"),
        @ApiResponse(responseCode = "404", description = "ç”¨æˆ·ä¸å­˜åœ¨")
    })
    public ApiResponse<UserResponse> getUser(
            @Parameter(description = "ç”¨æˆ·ID", required = true)
            @PathVariable @Min(1) Long id) {
        // å®ç°é€»è¾‘
    }
}
```

#### Serviceç±»æ³¨è§£
```java
@Service
@Transactional(readOnly = true)
@Slf4j
public class UserServiceImpl implements UserService {
    
    @Transactional
    @Override
    public User createUser(CreateUserRequest request) {
        // å®ç°é€»è¾‘
    }
}
```

### å¼‚å¸¸å¤„ç†è§„èŒƒ

#### è‡ªå®šä¹‰å¼‚å¸¸ç±»
```java
@Getter
public class BusinessException extends RuntimeException {
    private final String code;
    private final String message;
    
    public BusinessException(String code, String message) {
        super(message);
        this.code = code;
        this.message = message;
    }
    
    public BusinessException(ResultCode resultCode) {
        super(resultCode.getMessage());
        this.code = resultCode.getCode();
        this.message = resultCode.getMessage();
    }
}
```

#### å…¨å±€å¼‚å¸¸å¤„ç†
```java
@RestControllerAdvice
@Slf4j
public class GlobalExceptionHandler {
    
    @ExceptionHandler(BusinessException.class)
    public ApiResponse<Void> handleBusinessException(BusinessException e) {
        log.warn("ä¸šåŠ¡å¼‚å¸¸: {}", e.getMessage());
        return ApiResponse.error(e.getCode(), e.getMessage());
    }
    
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ApiResponse<Void> handleValidationException(MethodArgumentNotValidException e) {
        String message = e.getBindingResult().getFieldErrors().stream()
                .map(FieldError::getDefaultMessage)
                .collect(Collectors.joining(", "));
        log.warn("å‚æ•°éªŒè¯å¤±è´¥: {}", message);
        return ApiResponse.error("VALIDATION_ERROR", message);
    }
}
```

### æ—¥å¿—è§„èŒƒ

#### æ—¥å¿—çº§åˆ«ä½¿ç”¨
- **ERROR**: ç³»ç»Ÿé”™è¯¯ï¼Œéœ€è¦ç«‹å³å¤„ç†
- **WARN**: è­¦å‘Šä¿¡æ¯ï¼Œéœ€è¦å…³æ³¨ä½†ä¸å½±å“ç³»ç»Ÿè¿è¡Œ
- **INFO**: é‡è¦çš„ä¸šåŠ¡æµç¨‹ä¿¡æ¯
- **DEBUG**: è°ƒè¯•ä¿¡æ¯ï¼Œç”Ÿäº§ç¯å¢ƒä¸è¾“å‡º

#### æ—¥å¿—æ ¼å¼è§„èŒƒ
```java
@Service
@Slf4j
public class UserServiceImpl implements UserService {
    
    @Override
    public User createUser(CreateUserRequest request) {
        log.info("å¼€å§‹åˆ›å»ºç”¨æˆ·, username: {}", request.getUsername());
        
        try {
            // ä¸šåŠ¡é€»è¾‘
            User user = userRepository.save(newUser);
            log.info("ç”¨æˆ·åˆ›å»ºæˆåŠŸ, userId: {}, username: {}", user.getId(), user.getUsername());
            return user;
        } catch (Exception e) {
            log.error("ç”¨æˆ·åˆ›å»ºå¤±è´¥, username: {}, error: {}", request.getUsername(), e.getMessage(), e);
            throw new BusinessException("USER_CREATE_FAILED", "ç”¨æˆ·åˆ›å»ºå¤±è´¥");
        }
    }
}
```

## ğŸ—„ï¸ æ•°æ®åº“è§„èŒƒ

### è¡¨å‘½åè§„èŒƒ
- ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿
- è¡¨åä½¿ç”¨å¤æ•°å½¢å¼
- å…³è”è¡¨ä½¿ç”¨ä¸¤ä¸ªè¡¨åç»„åˆ

```sql
-- æ­£ç¡®ç¤ºä¾‹
users
projects
test_cases
user_projects

-- é”™è¯¯ç¤ºä¾‹
User
project
testCase
userProject
```

### å­—æ®µå‘½åè§„èŒƒ
- ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿
- ä¸»é”®ç»Ÿä¸€ä½¿ç”¨`id`
- å¤–é”®ä½¿ç”¨`è¡¨å_id`æ ¼å¼
- æ—¶é—´å­—æ®µä½¿ç”¨`_at`åç¼€

```sql
-- æ­£ç¡®ç¤ºä¾‹
id
user_id
project_id
created_at
updated_at

-- é”™è¯¯ç¤ºä¾‹
userId
projectId
createTime
updateTime
```

### ç´¢å¼•è§„èŒƒ
- ä¸»é”®ç´¢å¼•: `pk_è¡¨å`
- å”¯ä¸€ç´¢å¼•: `uk_è¡¨å_å­—æ®µå`
- æ™®é€šç´¢å¼•: `idx_è¡¨å_å­—æ®µå`
- å¤åˆç´¢å¼•: `idx_è¡¨å_å­—æ®µ1_å­—æ®µ2`

## ğŸ“¡ APIè®¾è®¡è§„èŒƒ

### RESTful APIè§„èŒƒ
```http
# èµ„æºæ“ä½œ
GET    /api/users           # è·å–ç”¨æˆ·åˆ—è¡¨
GET    /api/users/{id}      # è·å–æŒ‡å®šç”¨æˆ·
POST   /api/users           # åˆ›å»ºç”¨æˆ·
PUT    /api/users/{id}      # æ›´æ–°ç”¨æˆ·
DELETE /api/users/{id}      # åˆ é™¤ç”¨æˆ·

# å­èµ„æºæ“ä½œ
GET    /api/users/{id}/projects     # è·å–ç”¨æˆ·çš„é¡¹ç›®åˆ—è¡¨
POST   /api/users/{id}/projects     # ä¸ºç”¨æˆ·æ·»åŠ é¡¹ç›®

# åŠ¨ä½œæ“ä½œ
PUT    /api/users/{id}/enable       # å¯ç”¨ç”¨æˆ·
PUT    /api/users/{id}/disable      # ç¦ç”¨ç”¨æˆ·
POST   /api/users/{id}/reset-password  # é‡ç½®å¯†ç 
```

### å“åº”æ ¼å¼è§„èŒƒ
```java
// ç»Ÿä¸€å“åº”æ ¼å¼
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class ApiResponse<T> {
    private boolean success;
    private String code;
    private String message;
    private T data;
    private Long timestamp;
    
    public static <T> ApiResponse<T> success(T data) {
        return ApiResponse.<T>builder()
                .success(true)
                .code("SUCCESS")
                .message("æ“ä½œæˆåŠŸ")
                .data(data)
                .timestamp(System.currentTimeMillis())
                .build();
    }
    
    public static <T> ApiResponse<T> error(String code, String message) {
        return ApiResponse.<T>builder()
                .success(false)
                .code(code)
                .message(message)
                .timestamp(System.currentTimeMillis())
                .build();
    }
}
```

### åˆ†é¡µå“åº”æ ¼å¼
```java
@Data
@Builder
public class PageResponse<T> {
    private List<T> content;
    private int page;
    private int size;
    private long totalElements;
    private int totalPages;
    private boolean first;
    private boolean last;
}
```

## ğŸ§ª æµ‹è¯•è§„èŒƒ

### å•å…ƒæµ‹è¯•è§„èŒƒ
```java
@ExtendWith(MockitoExtension.class)
class UserServiceImplTest {
    
    @Mock
    private UserRepository userRepository;
    
    @InjectMocks
    private UserServiceImpl userService;
    
    @Test
    @DisplayName("åˆ›å»ºç”¨æˆ· - æˆåŠŸ")
    void createUser_Success() {
        // Given
        CreateUserRequest request = CreateUserRequest.builder()
                .username("testuser")
                .email("test@example.com")
                .build();
        
        User savedUser = User.builder()
                .id(1L)
                .username("testuser")
                .email("test@example.com")
                .build();
        
        when(userRepository.save(any(User.class))).thenReturn(savedUser);
        
        // When
        User result = userService.createUser(request);
        
        // Then
        assertThat(result).isNotNull();
        assertThat(result.getId()).isEqualTo(1L);
        assertThat(result.getUsername()).isEqualTo("testuser");
        verify(userRepository).save(any(User.class));
    }
    
    @Test
    @DisplayName("åˆ›å»ºç”¨æˆ· - ç”¨æˆ·åå·²å­˜åœ¨")
    void createUser_UsernameExists() {
        // Given
        CreateUserRequest request = CreateUserRequest.builder()
                .username("existuser")
                .build();
        
        when(userRepository.existsByUsername("existuser")).thenReturn(true);
        
        // When & Then
        assertThatThrownBy(() -> userService.createUser(request))
                .isInstanceOf(BusinessException.class)
                .hasMessage("ç”¨æˆ·åå·²å­˜åœ¨");
    }
}
```

### é›†æˆæµ‹è¯•è§„èŒƒ
```java
@SpringBootTest
@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)
@TestPropertySource(locations = "classpath:application-test.properties")
class UserControllerIntegrationTest {
    
    @Autowired
    private TestRestTemplate restTemplate;
    
    @Autowired
    private UserRepository userRepository;
    
    @Test
    @DisplayName("åˆ›å»ºç”¨æˆ·æ¥å£æµ‹è¯•")
    void createUser_Integration() {
        // Given
        CreateUserRequest request = CreateUserRequest.builder()
                .username("integrationtest")
                .email("integration@test.com")
                .password("123456")
                .build();
        
        // When
        ResponseEntity<ApiResponse> response = restTemplate.postForEntity(
                "/api/users", request, ApiResponse.class);
        
        // Then
        assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK);
        assertThat(response.getBody().isSuccess()).isTrue();
        
        // éªŒè¯æ•°æ®åº“
        Optional<User> savedUser = userRepository.findByUsername("integrationtest");
        assertThat(savedUser).isPresent();
    }
}
```

## ğŸ“‹ ä»£ç å®¡æŸ¥æ¸…å•

### åŠŸèƒ½æ€§æ£€æŸ¥
- [ ] åŠŸèƒ½å®ç°æ˜¯å¦ç¬¦åˆéœ€æ±‚
- [ ] è¾¹ç•Œæ¡ä»¶æ˜¯å¦å¤„ç†
- [ ] å¼‚å¸¸æƒ…å†µæ˜¯å¦å¤„ç†
- [ ] è¾“å…¥éªŒè¯æ˜¯å¦å®Œæ•´

### ä»£ç è´¨é‡æ£€æŸ¥
- [ ] å‘½åæ˜¯å¦è§„èŒƒ
- [ ] ä»£ç ç»“æ„æ˜¯å¦æ¸…æ™°
- [ ] æ³¨é‡Šæ˜¯å¦å……åˆ†
- [ ] æ˜¯å¦æœ‰é‡å¤ä»£ç 

### æ€§èƒ½æ£€æŸ¥
- [ ] æ•°æ®åº“æŸ¥è¯¢æ˜¯å¦ä¼˜åŒ–
- [ ] æ˜¯å¦å­˜åœ¨N+1æŸ¥è¯¢é—®é¢˜
- [ ] ç¼“å­˜ä½¿ç”¨æ˜¯å¦åˆç†
- [ ] èµ„æºæ˜¯å¦æ­£ç¡®é‡Šæ”¾

### å®‰å…¨æ£€æŸ¥
- [ ] è¾“å…¥æ˜¯å¦éªŒè¯å’Œè¿‡æ»¤
- [ ] æƒé™æ§åˆ¶æ˜¯å¦æ­£ç¡®
- [ ] æ•æ„Ÿä¿¡æ¯æ˜¯å¦åŠ å¯†
- [ ] SQLæ³¨å…¥æ˜¯å¦é˜²æŠ¤

### æµ‹è¯•æ£€æŸ¥
- [ ] å•å…ƒæµ‹è¯•æ˜¯å¦å……åˆ†
- [ ] æµ‹è¯•ç”¨ä¾‹æ˜¯å¦è¦†ç›–ä¸»è¦åœºæ™¯
- [ ] æµ‹è¯•æ•°æ®æ˜¯å¦åˆç†
- [ ] æµ‹è¯•æ˜¯å¦å¯é‡å¤æ‰§è¡Œ

---
